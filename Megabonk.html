<!DOCTYPE html>
<html>
<head>
    <title>üî• MEGABONK PRO MAX ENDLESS - Hasan Ali üêí</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:#000;color:#0f0;font:18px monospace;overflow:hidden}
        canvas{display:block;background:linear-gradient(#001122,#000)}
        #ui{position:absolute;top:10px;left:10px;color:#ff0;z-index:10}
        #waveComplete,#shop,#gameOver{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:100;color:#ff0}
        button{background:#f00;color:#fff;border:none;padding:15px 30px;margin:8px;font:22px monospace;cursor:pointer;border-radius:12px}
        button:active{transform:scale(0.92)}
        .shop-btn{width:300px}
    </style>
</head>
<body>
<canvas id="game"></canvas>

<div id="ui">
    Wave: <span id="wave">1</span> | Puan: <span id="score">0</span> (x<span id="combo">1</span>)<br>
    Can: <span id="health">100</span>% | Altƒ±n: $<span id="gold">0</span>
</div>

<div id="waveComplete">
    <h1>WAVE <span id="wcWave">1</span> TAMAMLANDI!</h1>
    <p>Bonus: +<span id="bonusGold">0</span> Altƒ±n</p>
    <button onclick="openShop()">SHOP A√á (Kalƒ±cƒ± Upgrade)</button>
    <button onclick="nextWave()">SONRAKƒ∞ WAVE</button>
</div>

<div id="shop">
    <h1>üõí KALICI SHOP (Her run‚Äôda kalƒ±r)</h1>
    <button class="shop-btn" onclick="buyPermanent(0)">Hasar +20% ($<span id="cost0">50</span>)</button>
    <button class="shop-btn" onclick="buyPermanent(1)">Max Can +20 ($<span id="cost1">80</span>)</button>
    <button class="shop-btn" onclick="buyPermanent(2)">Hƒ±z +2 ($<span id="cost2">100</span>)</button>
    <button class="shop-btn" onclick="buyPermanent(3)">Yeni Silah (Lazer) ($<span id="cost3">150</span>)</button>
    <button onclick="closeShop()">KAPAT</button>
</div>

<div id="gameOver">
    <h1>GAME OVER</h1>
    <p>Biten Wave: <span id="finalWave">1</span></p>
    <p>Bu run Gold: <span id="runGold">0</span></p>
    <p>En ƒ∞yi Wave: <span id="bestWave">1</span></p>
    <button onclick="location.reload()">YENƒ∞DEN BA≈ûLA</button>
</div>

<script>
// ============== PERMANENT PROGRESSION (S√úRD√úR√úLEBƒ∞Lƒ∞RLƒ∞K) ==============
let permanent = {
    damageMult: 1,
    maxHealth: 100,
    speedBonus: 0,
    hasLazer: false,
    bestWave: 1
};
const SAVE_KEY = 'megabonk_permanent';
function loadPermanent() {
    const saved = localStorage.getItem(SAVE_KEY);
    if (saved) permanent = JSON.parse(saved);
}
function savePermanent() {
    localStorage.setItem(SAVE_KEY, JSON.stringify(permanent));
}
loadPermanent();

// ============== OYUN DEƒûƒ∞≈ûKENLERƒ∞ ==============
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;
window.addEventListener('resize', ()=>{W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;});

let player = {x:W/2, y:H-180, vy:0, size:38, onGround:true, health:permanent.maxHealth, speed:8 + permanent.speedBonus};
let projectiles = [], enemies = [], gems = [], particles = [], trails = [];
let score = 0, combo = 1, gold = 0, wave = 1;
let enemiesToSpawn = 0, enemiesSpawned = 0;
let weapons = [{name:'Bonk', dmg:25, rate:12, cooldown:0}]; // ba≈ülangƒ±√ß
if (permanent.hasLazer) weapons.push({name:'Lazer', dmg:18, rate:7, cooldown:0});
let gameSpeed = 2.8, paused = false, inShop = false;

let keys = {}, joystick = {active:false, dx:0};

// Touch
canvas.addEventListener('touchstart', e=>{ const t=e.touches[0]; if(t.clientX > W/2){ if(player.onGround){player.vy=-19;player.onGround=false;} } else joystick.active=true; });
canvas.addEventListener('touchmove', e=>{ if(joystick.active){const t=e.touches[0];joystick.dx=(t.clientX-120)/70;} });
canvas.addEventListener('touchend', ()=>{joystick.active=false; joystick.dx=0;});

// Klavye
window.addEventListener('keydown', e=>keys[e.key]=true);
window.addEventListener('keyup', e=>keys[e.key]=false);

function spawnEnemy(type=0) {
    let hp = 35 + wave*8;
    let speed = -gameSpeed;
    let size = 24;
    if(type===1){ speed = -gameSpeed*1.6; hp*=0.7; size=18; } // fast
    if(type===2){ hp*=2.2; size=32; } // tank
    if(type===3){ size=22; } // shooter
    enemies.push({x:W+60, y:H-140-Math.random()*90, size, health:hp, vx:speed, type, shootTimer:0});
}

function startNewWave() {
    enemies = []; gems = [];
    wave++;
    enemiesToSpawn = 7 + wave*4;
    enemiesSpawned = 0;
    document.getElementById('wave').textContent = wave;
    if(wave % 5 === 0) enemiesToSpawn += 3; // boss wave daha kalabalƒ±k
}

function shoot() {
    weapons.forEach(w => {
        if(w.cooldown <= 0){
            w.cooldown = w.rate;
            let target = null, minD = Infinity;
            enemies.forEach(en=>{ const d=Math.hypot(en.x-player.x, en.y-player.y); if(d<minD){minD=d;target=en;} });
            if(target){
                const dx = target.x - player.x;
                const dy = target.y - player.y - 20;
                const dist = Math.hypot(dx,dy)||1;
                projectiles.push({x:player.x, y:player.y-15, vx:dx/dist*14, vy:dy/dist*14, dmg:w.dmg*permanent.damageMult, life:70, color:'#ff0'});
            }
        }
    });
}

function createParticle(x,y,color,size=5,count=20) {
    for(let i=0;i<count;i++){
        particles.push({x,y,vx:Math.random()*16-8,vy:Math.random()*14-12,life:38,size:Math.random()*size+3,color});
    }
}

// Wave Complete
function waveComplete() {
    paused = true;
    const bonus = 40 + wave*35;
    gold += bonus;
    document.getElementById('wcWave').textContent = wave;
    document.getElementById('bonusGold').textContent = bonus;
    document.getElementById('waveComplete').style.display = 'flex';
    savePermanent();
}

// Shop
function openShop() {
    document.getElementById('waveComplete').style.display = 'none';
    document.getElementById('shop').style.display = 'flex';
    inShop = true;
    // maliyet g√ºncelle
    document.getElementById('cost0').textContent = Math.floor(50 + wave*8);
    document.getElementById('cost1').textContent = Math.floor(80 + wave*10);
    document.getElementById('cost2').textContent = Math.floor(100 + wave*12);
    document.getElementById('cost3').textContent = Math.floor(150 + wave*15);
}
function buyPermanent(i) {
    const costs = [50+wave*8,80+wave*10,100+wave*12,150+wave*15];
    if(gold < costs[i]) return alert("Yeterli altƒ±n yok!");
    gold -= costs[i];
    if(i===0) permanent.damageMult += 0.2;
    if(i===1) {permanent.maxHealth += 20; player.health = permanent.maxHealth;}
    if(i===2) permanent.speedBonus += 1.5;
    if(i===3 && !permanent.hasLazer){ permanent.hasLazer=true; weapons.push({name:'Lazer',dmg:18,rate:7,cooldown:0}); }
    savePermanent();
    alert("Kalƒ±cƒ± upgrade alƒ±ndƒ±! üéâ");
}
function closeShop() {
    document.getElementById('shop').style.display = 'none';
    inShop = false;
    nextWave();
}
function nextWave() {
    document.getElementById('waveComplete').style.display = 'none';
    paused = false;
    startNewWave();
}

// Game Over
function gameOver() {
    paused = true;
    if(wave > permanent.bestWave) permanent.bestWave = wave;
    savePermanent();
    document.getElementById('finalWave').textContent = wave-1;
    document.getElementById('runGold').textContent = gold;
    document.getElementById('bestWave').textContent = permanent.bestWave;
    document.getElementById('gameOver').style.display = 'flex';
}

function gameLoop() {
    if(paused || inShop) { requestAnimationFrame(gameLoop); return; }

    ctx.fillStyle = 'rgba(0,15,30,0.13)';
    ctx.fillRect(0,0,W,H);

    // 3D zemin
    ctx.strokeStyle = '#0a0'; ctx.lineWidth=4;
    for(let i=0;i<14;i++){
        const z = (i*38 + Date.now()/18 % 50);
        ctx.globalAlpha = 1-i/16;
        ctx.beginPath(); ctx.moveTo(0,H-85+z*0.65); ctx.lineTo(W,H-85+z*0.65); ctx.stroke();
    }
    ctx.globalAlpha=1;

    // Trail
    trails.push({x:player.x,y:player.y,a:0.85});
    trails.forEach((t,i)=>{ctx.globalAlpha=t.a; ctx.fillStyle='#0f0'; ctx.fillRect(t.x-12,t.y-12,24,24); t.a-=0.06; if(t.a<=0)trails.splice(i,1);});
    ctx.globalAlpha=1;

    // Hareket
    let mx = 0;
    if(keys['a']||keys['ArrowLeft']||joystick.dx<-0.3) mx = -(player.speed + permanent.speedBonus);
    if(keys['d']||keys['ArrowRight']||joystick.dx>0.3) mx = player.speed + permanent.speedBonus;
    player.x += mx;
    player.x = Math.max(40,Math.min(W-40,player.x));

    player.vy += 0.82;
    player.y += player.vy;
    if(player.y > H-175){player.y=H-175; player.vy=0; player.onGround=true;}

    // Silah ate≈ü
    weapons.forEach(w=>{if(w.cooldown>0)w.cooldown--;});
    if(Math.random()<0.45) shoot();

    // Projectile
    projectiles = projectiles.filter(p=>{
        p.x+=p.vx; p.y+=p.vy; p.life--;
        ctx.shadowColor=p.color; ctx.shadowBlur=25;
        ctx.fillStyle=p.color;
        ctx.fillRect(p.x-5,p.y-5,10,10);
        ctx.shadowBlur=0;
        return p.life>0;
    });

    // D√º≈üman spawn
    if(enemiesSpawned < enemiesToSpawn && Math.random()<0.045 + wave*0.003){
        const type = Math.random()<0.25 ? 1 : Math.random()<0.4 ? 2 : Math.random()<0.6 ? 3 : 0;
        spawnEnemy(type);
        enemiesSpawned++;
    }

    // D√º≈ümanlar
    enemies = enemies.filter(en=>{
        // hareket + AI
        const dx = player.x - en.x;
        en.x += dx*0.018 + en.vx;
        en.y += (player.y - en.y)*0.012;

        if(en.type===3 && Math.random()<0.03){ // shooter ate≈ü eder
            projectiles.push({x:en.x, y:en.y, vx: (player.x-en.x)/40, vy:(player.y-en.y)/40, dmg:12, life:80, color:'#f0f'});
        }

        // √ßarpƒ±≈üma
        if(Math.hypot(en.x-player.x, en.y-player.y) < en.size + player.size){
            player.health -= 1.2;
            createParticle(en.x,en.y,'#f00',7,12);
            return false;
        }

        // projectile vuru≈ü
        let alive = true;
        projectiles.forEach((p,i)=>{
            if(Math.hypot(p.x-en.x, p.y-en.y) < en.size+4){
                en.health -= p.dmg;
                projectiles.splice(i,1);
                createParticle(en.x,en.y,'#ff0');
                if(en.health <= 0){
                    score += 30*combo;
                    gold += 3;
                    combo = Math.min(12, combo+0.4);
                    spawnGem(en.x,en.y);
                    alive = false;
                }
            }
        });
        if(!alive) return false;

        // √ßiz
        let col = en.type===1?'#0ff':en.type===2?'#f80':en.type===3?'#f0f':'#f00';
        ctx.shadowColor=col; ctx.shadowBlur=35;
        ctx.fillStyle=col;
        ctx.beginPath();
        ctx.arc(en.x,en.y,en.size,0,Math.PI*2);
        ctx.fill();
        ctx.shadowBlur=0;
        return en.x > -60;
    });

    // Gems
    gems.forEach((g,i)=>{
        g.x += (player.x-g.x)*0.09;
        g.y += (player.y-g.y)*0.09;
        ctx.shadowColor='#0ff'; ctx.shadowBlur=40;
        ctx.fillStyle='#0ff';
        ctx.beginPath(); ctx.arc(g.x,g.y,g.size,0,Math.PI*2); ctx.fill();
        if(Math.hypot(g.x-player.x,g.y-player.y)<38){
            xp = (xp||0) + 22;
            gems.splice(i,1);
            if(xp > 110 + wave*20){ xp=0; waveComplete(); }
        }
    });

    // Particles
    particles = particles.filter(p=>{
        p.x+=p.vx; p.y+=p.vy; p.vy+=0.28; p.life--;
        ctx.globalAlpha = p.life/38;
        ctx.fillStyle=p.color;
        ctx.fillRect(p.x,p.y,p.size,p.size);
        return p.life>0;
    });
    ctx.globalAlpha=1;

    // Monke
    ctx.shadowColor='#0f0'; ctx.shadowBlur=55;
    ctx.font='68px serif';
    ctx.textAlign='center';
    ctx.fillText('üêí',player.x,player.y);
    ctx.shadowBlur=0;

    // UI
    document.getElementById('score').textContent = Math.floor(score);
    document.getElementById('combo').textContent = combo.toFixed(1);
    document.getElementById('health').textContent = Math.floor(player.health);
    document.getElementById('gold').textContent = gold;
    document.getElementById('wave').textContent = wave;

    // Wave biti≈ü kontrol√º
    if(enemies.length===0 && enemiesSpawned >= enemiesToSpawn && !paused){
        waveComplete();
    }

    // Game Over
    if(player.health <= 0) gameOver();

    combo = Math.max(1, combo-0.004);
    requestAnimationFrame(gameLoop);
}

function spawnGem(x,y){ gems.push({x,y,size:11}); }

// Ba≈ülangƒ±√ß
startNewWave();
for(let i=0;i<5;i++) spawnEnemy();
gameLoop();
</script>
</body>
</html>